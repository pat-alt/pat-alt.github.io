{
  "hash": "f5f345e72f657b2ccabfe81951138360",
  "result": {
    "markdown": "---\ntitle: Endogenous Macrodynamics in Algorithmic Recourse\nsubtitle: IEEE --- Secure and Trustworthy Machine Learning\nauthor: \n  - name: \"**Patrick Altmeyer**\"\n    url: https://www.paltmeyer.com/\n  - name: Giovan Angela\n  - name: Aleksander \n  - name: Karol\n  - name: Arie van Deursen\n  - name: Cynthia C. S. Liem\ninstitute: Delft University of Technology\ndate: today\nformat: \n  tudelft-revealjs:\n    theme: custom.scss\n    footer: IEEE Secure and Trustworthy Machine Learning '23 --- Patrick Altmeyer --- CC BY-NC\n    self-contained: true\n    smaller: true\n    scrollable: true\n    preview-links: auto\n    slide-number: true\n    transition: slide\n    background-transition: fade\n    fig-align: center\n---\n\n\n## Quick Intro\n\n::::{.columns}\n\n:::{.column width=\"60%\"}\n\n- Currently 2nd year of PhD in Trustworthy Artificial Intelligence at Delft University of Technology.\n- Working on Counterfactual Explanations and Probabilistic Machine Learning with applications in Finance.\n- Previously, educational background in Economics and Finance and two years at the Bank of England.\n- Enthusiastic about free open-source software, in particular Julia and Quarto. \n\n:::\n\n:::{.column width=\"40%\"}\n\n<img src=\"/www/images/profile.jpg\" height=\"auto\" width=\"250\" style=\"border-radius:50%; display: block; margin-left: auto; margin-right: auto;\">\n\n<div style=\"text-align: center;\">\n  <p style=\"display: inline; vertical-align: middle\"> \n    <a href=\"https://www.linkedin.com/in/patrick-altmeyer-a2a25494/\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/d0fc399dee4218d1e0e0399b8947acab.png\" alt=\"LinkedIn (Personal)\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://twitter.com/paltmey\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/3949237f892004c237021ac9e3182b1d.png\" alt=\"Twitter\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://github.com/pat-alt\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/47f4eb2d0082a8a3611d614b75a09db8.png\" alt=\"Github\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://medium.com/@patrick.altmeyer\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/175f49662614345cb7dbb95fce3f88af.png\" alt=\"Medium\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n  </p>\n</div>\n\n<img src=\"/www/images/qr.png\" height=\"auto\" width=\"100\" style=\"display: block; margin-left: auto; margin-right: auto;\">\n:::\n\n::::\n\n# Motivation and Contributions\n\n## In a nutshell ... \n\n> [...] we run experiments that simulate the application of recourse in practice using various state-of-the-art counterfactual generators and find that all of them induce substantial domain and model shifts.\n\n- **Counterfactual Explanation** (CE) explain how inputs into a model need to change for it to produce different outputs.\n- Counterfactual Explanations that involve realistic and actionable changes can be used for the purpose of **Algorithmic Recourse** (AR) to help individuals who face adverse outcomes.\n\n![Dynamics in Algorithmic Recourse: (a) we have a simple linear classifier trained for binary classification where samples from the negative class ($y=0$) are marked in blue and samples of the positive class ($y=1$) are marked in orange; (b) the implementation of AR for a random subset of individuals leads to a noticable domain shift; (c) as the classifier is retrained we observe a corresponding model shift; (d) as this process is repeated, the decision boundary moves away from the target class.](/www/images/ieee_poc.png){#fig-poc}\n\n:::{.callout-tip}\n\n## 🔑 Key Contributions\n\n- We find that the induced shifts are substantial enough to likely impede the applicability of Algorithmic Recourse in some situations.\n- Fortunately, we find various strategies to mitigate these concerns. \n- Our simulation framework for studying recourse dynamics is fast and open-sourced. \n\n:::\n\n## Consumer Credit Example\n\n::: {.incremental}\n- Suppose @fig-poc relates to an automated decision-making system used by a retail bank to evaluate credit applicants with respect to their creditworthiness. \n- Assume that the two features are meaningful in the sense that creditworthiness increases in the south-east direction. \n- Then we can think of the outcome in panel (d) as representing a situation where the bank supplies credit to more borrowers (orange), but these borrowers are on average less creditworthy and more of them can be expected to default on their loan. \n- This represents a cost to the retail bank.\n:::\n\n## Student Admission Example\n\n::: {.incremental}\n- Suppose Figure @fig-poc relates to an automated decision-making system used by a university in its student admission process. \n- Assume that the two features are meaningful in the sense that the likelihood of students completing their degree increases in the south-east direction. \n- Then we can think of the outcome in panel (b) as representing a situation where more students are admitted to university (orange), but they are more likely to fail their degree than students that were admitted in previous years. \n- The university admission committee catches on to this and suspends its efforts to offer Algorithmic Recourse. \n- This represents an opportunity cost to future student applicants, that may have derived utility from being offered recourse.\n:::\n\n# Background\n\n## Algorithmic Recourse\n\n> Even though [...] interpretability is of great importance and should be pursued, explanations can, in principle, be offered without opening the “black box”.\n> [@wachter2017counterfactual]\n\n::::{.columns}\n\n:::{.column width=\"50%\"}\n\n#### Framework\n\n. . .\n\nObjective originally proposed by @wachter2017counterfactual is as follows\n\n$$\n\\min_{x^\\prime \\in \\mathcal{X}} \\text{cost}(x^\\prime) \\ \\ \\ \\mbox{s. t.} \\ \\ \\ M(x^\\prime) = y^* \n$$ {#eq-obj}\n\nTypically this is approximated through regularization:\n\n$$\nx^\\prime = \\arg \\min_{x^\\prime}  \\text{yloss}(M(x^\\prime),y^*) + \\lambda \\text{cost}(x^\\prime) \n$$ {#eq-solution}\n\n:::\n\n:::{.column width=\"50%\"}\n\n#### Intuition\n\n. . .\n\n![A cat performing gradient descent in the feature space à la @wachter2017counterfactual.](https://raw.githubusercontent.com/pat-alt/CounterfactualExplanations.jl/main/docs/src/www/recourse_mlp.gif){#fig-cat-mlp}\n\n:::\n\n# Gradient-Based Recourse Revisited {#method}\n\n## From individual recourse ... {#method-general}\n\n- We include the following generators in our simulation experiments below: **REVISE** [@joshi2019realistic], **CLUE** [@antoran2020getting], **DiCE** [@mothilal2020explaining] and a greedy approach that relies on probabilistic models [@schut2021generating].\n- All of them can be described by the following generalized form of Equation \\@ref(eq:general):\n\n$$\n\\begin{aligned}\n\\mathbf{s}^\\prime &= \\arg \\min_{\\mathbf{s}^\\prime \\in \\mathcal{S}} \\left\\{  {\\text{yloss}(M(f(\\mathbf{s}^\\prime)),y^*)}+ \\lambda {\\text{cost}(f(\\mathbf{s}^\\prime)) }  \\right\\} \n\\end{aligned} \n$$ {#eq-general}\n\n- Here $\\mathbf{s}^\\prime=\\left\\{s_k^\\prime\\right\\}_K$ is a $K$-dimensional array of counterfactual states and $f: \\mathcal{S} \\mapsto \\mathcal{X}$ maps from the counterfactual state space to the feature space.\n\n## ... towards collective recourse {#method-collective}\n\n- All of the different approaches introduced above tackle the problem of Algorithmic Recourse from the perspective of one single individual.\n- We propose to extend Equation @eq-general as follows:\n\n$$\n\\begin{aligned}\n\\mathbf{s}^\\prime &= \\arg \\min_{\\mathbf{s}^\\prime \\in \\mathcal{S}} \\{ {\\text{yloss}(M(f(\\mathbf{s}^\\prime)),y^*)} \\\\ &+ \\lambda_1 {\\text{cost}(f(\\mathbf{s}^\\prime))} + \\lambda_2 {\\text{extcost}(f(\\mathbf{s}^\\prime))} \\}  \n\\end{aligned} \n$$ {#eq-collective}\n\n- Here $\\text{cost}(f(\\mathbf{s}^\\prime))$ denotes the proxy for private costs faced by the individual as before and $\\lambda_1$ governs to what extent that private cost ought to be penalized. \n- The newly introduced term $\\text{extcost}(f(\\mathbf{s}^\\prime))$ is meant to capture and address external costs incurred by the collective of individuals in response to changes in $\\mathbf{s}^\\prime$.\n- The underlying concept of private and external costs is borrowed from Economics and well-established in that field: when the decisions or actions by some individual market participant generate external costs, then the market is said to suffer from negative externalities and is considered inefficient [@pindyck2014microeconomics].\n\n# Modeling Endogenous Macrodynamics in Algorithmic Recourse {#method-2}\n\n## Research Questions\n\n::: {.proposition #shifts name=\"Endogenous Shifts\"}\nDoes the repeated implementation of recourse provided by state-of-the-art generators lead to shifts in the domain and model?\n:::\n\n::: {.proposition #costs name=\"Costs\"}\nIf so, are these dynamics substantial enough to be considered costly to stakeholders involved in real-world automated decision-making processes?\n:::\n\n::: {.proposition #het name=\"Heterogeneity\"}\nDo different counterfactual generators yield significantly different outcomes in this context? Furthermore, is there any heterogeneity concerning the chosen classifier and dataset?\n:::\n\n::: {.proposition #drive name=\"Drivers\"}\nWhat are the drivers of endogenous dynamics in Algorithmic Recourse?\n:::\n\n## Simulations {#method-2-experiment}\n\n\\begin{algorithm}\n\\caption{Simulation Experiment}\\label{algo-experiment}\n\\begin{algorithmic}[1]\n\\Procedure{Experiment}{$M,\\mathcal{D},G$}\n\\State $E\\gets \\emptyset$ \\Comment{Initialize evaluation $E$.}\n\\State $t\\gets 0$\n\\While{$t<T$}\n\\State $\\text{batch} \\subset \\mathcal{D}_0$ \\Comment{Sample from $\\mathcal{D}_0$  (assignment).}\n\\State $\\text{batch}\\gets G(\\text{batch})$ \\Comment{Generate counterfactuals.}\n\\State $M\\gets M(\\mathcal{D})$ \\Comment{Retrain model.}\n\\State $E\\gets \\text{eval}(M,\\mathcal{D}) \\cup E$ \\Comment{Update evaluation.}\n\\State $t\\gets t+1$ \\Comment{Increment $t$.}\n\\EndWhile\n\\State \\textbf{return} $E, M,\\mathcal{D}$\n\\EndProcedure\n\\end{algorithmic}\n\\end{algorithm}\n\n## Evaluation Metrics {#method-2-metrics}\n\n# Experiment Setup {#empirical}\n\n## $M$---Classifiers and Generative Models {#empirical-classifiers}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab <- data.frame(\n  \"Model\" = c(\"MLP\",\"MLP\",\"VAE\",\"VAE\"),\n  \"Data\" = c(\"Synthetic\", \"Real-World\", \"Synthetic\", \"Real-World\"),\n  \"Hidden\" = c(32,64,32,32),\n  \"Latent\" = c(\"-\",\"-\",2,8),\n  \"Layers\" = c(1,2,1,1),\n  \"Batch\" = c(\"-\",500,\"-\",\"-\"),\n  \"Dropout\" = c(\"-\",0.1,\"-\",\"-\"),\n  \"Epochs\" = c(100,100,100,250)\n)\nlibrary(kableExtra)\nkbl(\n  tab, booktabs = TRUE,\n  caption = 'Neural network architectures and training parameters.',\n  col.names = c(\"Model\",\"Data\",\"Hidden Dim.\",\"Latent Dim.\",\"Hidden Layers\", \"Batch\", \"Dropout\", \"Epochs\")\n) |> \n  collapse_rows(1:2, row_group_label_position = 'stack') |>\n  kable_styling(latex_options = c(\"scale_down\"))\n```\n:::\n\n\n## $\\mathcal{D}$---Data {#empirical-data}\n\n### Synthetic Data\n\nWe use four synthetic binary classification datasets consisting of 1000 samples each: **Overlapping**, **Linearly Separable**, **Circles** and **Moons** @fig-synthetic-data.\n\n![Synthetic classification datasets used in our experiments. Samples from the negative class ($y=0$) are marked in blue while samples of the positive class ($y=1$) are marked in orange.](https://raw.githubusercontent.com/pat-alt/endogenous-macrodynamics-in-algorithmic-recourse/main/paper/www/synthetic_data.png){#fig-synthetic-data}\n\n### Real-World Data\n\nWe use three different real-world datasets from the Finance and Economics domain, all of which are tabular and can be used for binary classification. \n\n1. The **Give Me Some Credit** dataset: predict whether a borrower is likely to experience financial difficulties in the next two years [@kaggle2011give].\n2. The **UCI defaultCredit** dataset [@yeh2009comparisons]: a benchmark dataset that can be used to train binary classifiers to predict the whether credit card clients default on their payment.\n3. The **California Housing** dataset [@pedregosa2011scikitlearn, @pace1997sparse]: continuous outcome variable binarized as $\\tilde{y}=\\mathbb{I}_{y>\\text{median}(Y)}$ indicating if the median house price of a given district is above the median of all districts.\n\n## $G$---Generators\n\n- All generators introduced earlier are included in the experiments: Wachter [@wachter2017counterfactual], REVISE [@joshi2019realistic], CLUE [@antoran2020getting], DiCE [@mothilal2020explaining] and Greedy [@schut2021generating]. \n- In addition, we introduce two new generators in Section \\@ref(mitigate) that directly address the issue of endogenous domain and model shifts. We also test to what extent it may be beneficial to combine ideas underlying the various generators. \n\n# Experiments {#empirical-2}\n\n# Mitigation Strategies and Experiments {#mitigate}\n\n# Discussion {#discussion}\n\n# Limitations and Future Work {#limit}\n\n# Concluding Remarks {#conclusion}\n\n# Questions & Answers ❓\n\n# Final Things 🏁\n\n## More Resources 📚\n\n::::{.columns}\n\n:::{.column width=\"60%\"}\n\n> Read on ...\n\n- Related blog posts (hosted on this website that itself is built with Quarto and involves lots of Julia content): [[1]((https://www.paltmeyer.com/blog/posts/julia-and-quarto-a-match-made-in-heaven/))] and [[2](https://www.paltmeyer.com/blog/posts/tips-and-tricks-for-using-quarto-with-julia/)]. \n- Blog post introducing CE: [[TDS](https://towardsdatascience.com/individual-recourse-for-black-box-models-5e9ed1e4b4cc)], [[blog](https://www.paltmeyer.com/blog/posts/individual-recourse-for-black-box-models/)].\n- Blog post on Laplace Redux: [[TDS](https://towardsdatascience.com/go-deep-but-also-go-bayesian-ab25efa6f7b)], [[blog](https://www.paltmeyer.com/blog/posts/effortsless-bayesian-dl/)].\n- Blog post on Conformal Prediction: [[TDS](https://towardsdatascience.com/conformal-prediction-in-julia-351b81309e30)], [[blog](https://www.paltmeyer.com/blog/posts/conformal-prediction/)].\n\n> ... or get involved! 🤗\n\n- [Contributor's Guide](https://www.paltmeyer.com/CounterfactualExplanations.jl/dev/contributing/) for `CounterfactualExplanations.jl`\n- [Contributor's Guide](file:///Users/FA31DU/code/ConformalPrediction.jl/docs/build/contribute.html) for `ConformalPrediction.jl`\n\n:::\n\n:::{.column width=\"40%\"}\n\n<img src=\"/www/images/profile.jpg\" height=\"auto\" width=\"250\" style=\"border-radius:50%; display: block; margin-left: auto; margin-right: auto;\">\n\n<div style=\"text-align: center;\">\n  <p style=\"display: inline; vertical-align: middle\"> \n    <a href=\"https://www.linkedin.com/in/patrick-altmeyer-a2a25494/\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/d0fc399dee4218d1e0e0399b8947acab.png\" alt=\"LinkedIn (Personal)\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://twitter.com/paltmey\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/3949237f892004c237021ac9e3182b1d.png\" alt=\"Twitter\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://github.com/pat-alt\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/47f4eb2d0082a8a3611d614b75a09db8.png\" alt=\"Github\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n    <a href=\"https://medium.com/@patrick.altmeyer\" style=\"display: inline-block; color: rgb(207, 142, 255) !important;\">\n      <font style=\"\">\n        <img width=\"60\" height=\"60\" src=\"https://s1g.s3.amazonaws.com/175f49662614345cb7dbb95fce3f88af.png\" alt=\"Medium\" style=\"border: none; max-width: 100%; height: 60px !important;\">\n      </font>\n    </a>\n  </p>\n</div>\n\n<img src=\"/www/images/qr.png\" height=\"auto\" width=\"100\" style=\"display: block; margin-left: auto; margin-right: auto;\">\n:::\n\n::::\n\n## Image Sources\n\n- Quarto logo. Source: [Quarto](https://raw.githubusercontent.com/quarto-dev/quarto-web/main/quarto.png)\n- Julia to Quarto animation. Source: author (heavily borrowing from `Javis.jl` [tutorial](https://juliaanimators.github.io/Javis.jl/stable/tutorials/tutorial_7/))\n\n## References ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}