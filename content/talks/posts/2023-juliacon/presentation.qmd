---
title: "[`ConformalPrediction.jl`](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl)"
subtitle: Predictive Uncertainty Quantification in Machine Learning
author: 
  - name: "Patrick Altmeyer"
    url: https://www.paltmeyer.com/
institute: Delft University of Technology
date: today
date-format: long
format: 
  julia-revealjs:
    theme: custom.scss
    self-contained: true
    smaller: false
    scrollable: true
    preview-links: auto
    slide-number: true
    transition: slide
    background-transition: fade
    fig-align: center
    html-math-method: mathjax
    include-in-header:
      - text: |
          <script>
          MathJax = {
            options: {
              menuOptions: {
                settings: {
                  assistiveMml: false
                }
              }
            }
          };
          </script>
revealjs-plugins:
  - pointer
crossref: 
  prp-title: RQ
  prp-prefix: RQ
---

## Talk Agenda

::::{.columns}::::
:::{.column width='60%'}
1. Introduction (5min)
2. Interactive sprint of [`ConformalPrediction.jl`](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl) (10min)
3. Applications (5min)
4. Under Construction (5min)
5. Q&A
:::
:::{.column width='40%'}
> Scan this now to follow along ... if you're lucky 😅

![QR code redirects to notebook hosted on [binder](https://mybinder.org/).](www/qr_pluto.svg){width=45%}
:::
::::

## Conformal Prediction 

Conformal Prediction (CP) works under the premise of turning heuristic measures of Predictive Uncertainty (PU) into rigorous ones through repeated sampling or the use of calibration data.

![](www/intro.gif)

## Example: Split CP {.smaller}

1. Proper training set and separate calibration set: $\mathcal{D}_n=\mathcal{D}^{\text{train}} \cup \mathcal{D}^{\text{cali}}$.
2. Train model on proper training set: $\hat\mu_{i \in \mathcal{D}^{\text{train}}}(X_i,Y_i)$.
3. Compute nonconformity scores, $\mathcal{S}$, using calibration data $\mathcal{D}^{\text{cali}}$ and fitted model $\hat\mu_{i \in \mathcal{D}^{\text{train}}}$. 
4. For user-specified coverage ratio $(1-\alpha)$ compute the corresponding quantile, $\hat{q}$, of $\mathcal{S}$.
5. For the given quantile and test sample $X_{\text{test}}$, form the corresponding conformal prediction set: $C(X_{\text{test}})=\{y:s(X_{\text{test}},y) \le \hat{q}\}$.

::: {.callout-tip}
## Blog posts

- Conformal Classification ([[blog](https://www.paltmeyer.com/blog/posts/conformal-prediction/)], [[TDS](https://towardsdatascience.com/conformal-prediction-in-julia-351b81309e30)], [[Forem](https://forem.julialang.org/patalt/conformal-prediction-in-julia-h9n)])
- Conformal Regression ([[blog](https://www.paltmeyer.com/blog/posts/conformal-regression/)], [[TDS](https://towardsdatascience.com/prediction-intervals-for-any-regression-model-306930d5ad9a)], [[Forem](https://forem.julialang.org/patalt/prediction-intervals-for-any-regression-model-16f5)])
:::

# [`ConformalPrediction.jl`](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl)

::::{.columns}::::
:::{.column width='65%'}

- Built on top of [`MLJ.jl`](https://alan-turing-institute.github.io/MLJ.jl/dev/).
- Compatible with [`Flux.jl`](https://fluxml.ai/) through [`MLJFlux.jl`](https://github.com/FluxML/MLJFlux.jl).
- Many state-of-the-art CP methods implemented for regression, classification and time series modelling.

:::
:::{.column width='35%'}
![](www/wide_logo.png)

![](www/qr.svg)
:::
::::

# 🏃 Interactive Session {background-image="www/boston.png" background-position="90% 100%" background-size="50%"}

# 🔍 Applications {background-image="www/boston.png" background-position="90% 100%" background-size="50%"}

## Conformal Chatbot

::: {.panel-tabset}

### Overview

::::{.columns}::::
:::{.column width='40%'}
> Conformal Intent Classification and Clarification (CICC) won 1st 🏆 at ING Global Experiment Week 2023.
:::
:::{.column width='60%'}
![High-level overview of Conformal Intent Classifier.](www/llm.jpeg){#fig-llm width=100%}
:::
::::

### Demo

::::{.columns}::::
:::{.column width='55%'}
![Demo of a REPL-based conformalized intent classifier.](www/llm-demo.gif){#fig-llm-demo width=75%}
:::
:::{.column width='45%'}

CICC substantially outperforms baseline approaches (e.g. top-$K$).

::: {.callout-tip}
 
## Blog post

Building a Conformal Chatbot in Julia ([blog](https://www.paltmeyer.com/blog/posts/conformal-llm/), [TDS](https://medium.com/towards-data-science/building-a-conformal-chatbot-in-julia-1ed23363a280))
:::
:::
::::

:::

## Conformal Image Classifier

::::{.columns}::::
:::{.column width='60%'}
MNIST classifier trained using `MLJFlux.jl`.

![](www/img-clf-res.png){width=80%}
:::
:::{.column width='40%'}
![](www/img-clf.png){width=80%}
:::
::::

::: {.callout-tip}
## Blog post

How to Conformalize a Deep Image Classifier ([blog](https://www.paltmeyer.com/blog/posts/conformal-image-classifier/), [TDS](https://medium.com/towards-data-science/how-to-conformalize-a-deep-image-classifier-14ead4e1a5a0), [Forem](https://forem.julialang.org/patalt/how-to-conformalize-a-deep-image-classifier-50p2))
:::

## Time Series

::::{.columns}::::
:::{.column width='45%'}
Ensemble Batch Prediction Intervals [@xu2021conformal] contributed by [Mojtaba Farmanbar](https://www.linkedin.com/in/mfarmanbar/) 📣.

::: {.callout-tip}
## Tutorial

How to Conformalize a Time Series Model ([docs](https://juliatrustworthyai.github.io/ConformalPrediction.jl/stable/how_to_guides/timeseries/)) 
:::

:::
:::{.column width='55%'}
![EnbPI for Victoria electricity demand dataset.](www/timeseries.png){#fig-ts}
:::
::::

# 🚧 Under Construction {background-image="www/boston.png" background-position="90% 100%" background-size="50%"}

## Differentiability

::: {.incremental}

- @stutz2022learning introduce Conformal Training. ![Conformal Predictions (left), set size (centre) and smooth set size loss (right).](www/diff.svg){width=75%}
- We use this to generate Conformal [`CounterfactualExplanations.jl`](https://github.com/juliatrustworthyai/CounterfactualExplanations.jl).

:::

. . .

::: {.callout-note}

## Contribute

Currently working on full conformal training implementation [[#62](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl/issues/62)].

:::

## Conformal(ised) Bayes 

::::{.columns}::::
:::{.column width='50%'}

::: {.incremental}
- Predictive posterior as heuristic [@angelopoulos2021gentle].
- Importance Sampling [@fong2021conformal].
:::

:::
:::{.column width='50%'}

![](www/conformal-bayes.png)

:::
::::

. . .

::: {.callout-note}

## Contribute

[`LaplaceRedux.jl`](https://github.com/juliatrustworthyai/LaplaceRedux.jl) interfaced to [`MLJFlux.jl`](https://github.com/FluxML/MLJFlux.jl). Planning to add both ideas [[#64](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl/issues/64)]. 

:::

# 🗨️ and finally ... {background-image="www/boston.png" background-position="90% 100%" background-size="50%"}

## Trustworthy AI in `Julia` {.smaller}

::::{.columns}

:::{.column width="60%" .smaller}

Taija collects Julia packages geared towards Trustworthy AI:

- [`CounterfactualExplanations.jl`](https://github.com/juliatrustworthyai/CounterfactualExplanations.jl)
- [`ConformalPrediction.jl`](https://github.com/juliatrustworthyai/ConformalPrediction.jl) 
- [`LaplaceRedux.jl`](https://github.com/juliatrustworthyai/LaplaceRedux.jl)
- [`JointEnergyModels.jl`](https://github.com/juliatrustworthyai/JointEnergyModels.jl)
- ...

> Contributions welcome! 😊

:::

:::{.column width="40%"}

<img src="/www/images/qr.png" height="auto" width="250" style="display: block; margin-left: auto; margin-right: auto;">

<div style="text-align: center;">
  <p style="display: inline; vertical-align: middle"> 
    <a href="https://www.linkedin.com/in/patrick-altmeyer-a2a25494/" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/d0fc399dee4218d1e0e0399b8947acab.png" alt="LinkedIn (Personal)" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://twitter.com/paltmey" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/3949237f892004c237021ac9e3182b1d.png" alt="Twitter" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://github.com/pat-alt" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/47f4eb2d0082a8a3611d614b75a09db8.png" alt="Github" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://medium.com/@patrick.altmeyer" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/175f49662614345cb7dbb95fce3f88af.png" alt="Medium" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
  </p>
</div>

[![](www/taija.png){width=50%}](https://github.com/JuliaTrustworthyAI)

:::

::::

## References 