---
title: "[`ConformalPrediction.jl`](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl)"
subtitle: Predictive Uncertainty Quantification in Machine Learning
author: 
  - name: "Patrick Altmeyer"
    url: https://www.paltmeyer.com/
institute: Delft University of Technology
date: today
date-format: long
title-slide-attributes:
  data-background-image: www/wide_logo.png
  data-background-size: 20%
  data-background-position: 95% 95%
format: 
  julia-revealjs:
    theme: custom.scss
    self-contained: true
    smaller: false
    scrollable: true
    preview-links: auto
    slide-number: true
    transition: slide
    background-transition: fade
    fig-align: center
    html-math-method: mathjax
    include-in-header:
      - text: |
          <script>
          MathJax = {
            options: {
              menuOptions: {
                settings: {
                  assistiveMml: false
                }
              }
            }
          };
          </script>
revealjs-plugins:
  - pointer
crossref: 
  prp-title: RQ
  prp-prefix: RQ
---

## Conformal Prediction 

Conformal Prediction (CP) works under the premise of turning heuristic notions of Predictive Uncertainty (PU) into rigorous ones through repeated sampling or the use of calibration data.

![](www/intro.gif)

## Example: Split CP {.smaller}

1. Proper training set and separate calibration set: $\mathcal{D}_n=\mathcal{D}^{\text{train}} \cup \mathcal{D}^{\text{cali}}$.
2. Train model on proper training set: $\hat\mu_{i \in \mathcal{D}^{\text{train}}}(X_i,Y_i)$.
3. Compute nonconformity scores, $\mathcal{S}$, using calibration data $\mathcal{D}^{\text{cali}}$ and fitted model $\hat\mu_{i \in \mathcal{D}^{\text{train}}}$. 
4. For user-specified coverage ratio $(1-\alpha)$ compute the corresponding quantile, $\hat{q}$, of $\mathcal{S}$.
5. For the given quantile and test sample $X_{\text{test}}$, form the corresponding conformal prediction set: $C(X_{\text{test}})=\{y:s(X_{\text{test}},y) \le \hat{q}\}$.

::: {.callout-tip}
## Blog posts

- Conformal Classification ([[blog](https://www.paltmeyer.com/blog/posts/conformal-prediction/)], [[TDS](https://towardsdatascience.com/conformal-prediction-in-julia-351b81309e30)], [[Forem](https://forem.julialang.org/patalt/conformal-prediction-in-julia-h9n)])
- Conformal Regression ([[blog](https://www.paltmeyer.com/blog/posts/conformal-regression/)], [[TDS](https://towardsdatascience.com/prediction-intervals-for-any-regression-model-306930d5ad9a)], [[Forem](https://forem.julialang.org/patalt/prediction-intervals-for-any-regression-model-16f5)])
:::

## Talk Agenda {.smaller}

1. 🏃 Interactive sprint of [`ConformalPrediction.jl`](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl) (15min)
2. 🔍 Applications (5min)
   - Conformal Chatbot
   - Conformal Image Classifier
3. 🚧 Under Construction (5min)
   - Differentiability and Conformal [`CounterfactualExplanations.jl`](https://github.com/JuliaTrustworthyAI/CounterfactualExplanations.jl)
   - Conformal Bayes and [`LaplaceRedux.jl`](https://github.com/JuliaTrustworthyAI/LaplaceRedux.jl)
4. ❓ Q&A

# 🔍 Applications

## Conformal Chatbot {.smaller}

::: {.panel-tabset}

### Overview

![High-level overview of a conformalized intent classifier.](www/llm.jpeg){#fig-llm width=75%}

::: {.callout-tip}
## Blog post

Building a Conformal Chatbot in Julia ([[blog](https://www.paltmeyer.com/blog/posts/conformal-llm/)], [[TDS](https://medium.com/towards-data-science/building-a-conformal-chatbot-in-julia-1ed23363a280)])
:::

### Demo

![Demo of a REPL-based conformalized intent classifier.](www/llm-demo.gif){#fig-llm-demo width=50%}

:::

## Conformal Image Classifier

::::{.columns}::::
:::{.column width='60%'}
MNIST classifier trained using `MLJFlux.jl`.

![](www/img-clf-res.png){width=80%}
:::
:::{.column width='40%'}
![](www/img-clf.gif){width=80%}
:::
::::

::: {.callout-tip}
## Blog post

How to Conformalize a Deep Image Classifier ([[blog](https://www.paltmeyer.com/blog/posts/conformal-image-classifier/)], [[TDS](https://medium.com/towards-data-science/how-to-conformalize-a-deep-image-classifier-14ead4e1a5a0)], [[Forem](https://forem.julialang.org/patalt/how-to-conformalize-a-deep-image-classifier-50p2)])
:::

# 🚧 Under Construction

## Differentiability {.smaller}

::: {.incremental}

- @stutz2022learning introduce a smooth set size penalty to explicitly train models for efficient CP. 
- We use this in the context of gradient-based counterfactual search to obtain plausible [`CounterfactualExplanations.jl`](https://github.com/juliatrustworthyai/CounterfactualExplanations.jl) (currently under review).

:::

![Conformal Predictions (left), set size (centre) and smooth set size loss (right).](www/diff.svg)

::: {.callout-note}

## Contribute

Currently working on full conformal training implementation [[#62](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl/issues/62)].

:::

## Conformal Bayes

::: {.incremental}

1. Conformalised Bayes: simply treat Bayesian predictive posterior as our heuristic [@angelopoulos2021gentle].
   - Recently interfaced [`LaplaceRedux.jl`](https://github.com/juliatrustworthyai/LaplaceRedux.jl) to [`MLJFlux.jl`](), which paves the way for truly effortless conformalized Bayesian Deep Learning.
2. Conformal Bayes through importance sampling [@fong2021conformal].

:::



::: {.callout-note}

## Contribute

Planning to add both ideas [[#64](https://github.com/JuliaTrustworthyAI/ConformalPrediction.jl/issues/64)].

:::

# ❓ Q&A

## Towards Trustworthy AI in `Julia` 

> Home of packages geared towards Trustworthy Artificial Intelligence in `Julia`.

::::{.columns}

:::{.column width="60%"}

##### [`Taija`](https://github.com/JuliaTrustworthyAI)

1. [`CounterfactualExplanations.jl`](https://github.com/juliatrustworthyai/CounterfactualExplanations.jl) (JuliaCon 2022)
2. [`ConformalPrediction.jl`](https://github.com/juliatrustworthyai/ConformalPrediction.jl) (JuliaCon 2023)
3. [`LaplaceRedudx.jl`](https://github.com/juliatrustworthyai/LaplaceRedux.jl) (JuliaCon 2022)
4. [`AlgorithmicRecourseDynamics.jl`](https://github.com/juliatrustworthyai/AlgorithmicRecourseDynamics.jl)

... contributions welcome! 😊

:::

:::{.column width="40%"}

<img src="/www/images/qr.png" height="auto" width="250" style="display: block; margin-left: auto; margin-right: auto;">

<div style="text-align: center;">
  <p style="display: inline; vertical-align: middle"> 
    <a href="https://www.linkedin.com/in/patrick-altmeyer-a2a25494/" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/d0fc399dee4218d1e0e0399b8947acab.png" alt="LinkedIn (Personal)" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://twitter.com/paltmey" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/3949237f892004c237021ac9e3182b1d.png" alt="Twitter" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://github.com/pat-alt" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/47f4eb2d0082a8a3611d614b75a09db8.png" alt="Github" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
    <a href="https://medium.com/@patrick.altmeyer" style="display: inline-block; color: rgb(207, 142, 255) !important;">
      <font style="">
        <img width="60" height="60" src="https://s1g.s3.amazonaws.com/175f49662614345cb7dbb95fce3f88af.png" alt="Medium" style="border: none; max-width: 100%; height: 60px !important;">
      </font>
    </a>
  </p>
</div>
:::

::::

## 📚 More Reading

- Granular results for all of our experiments can be found in this online companion: [https://www.paltmeyer.com/endogenous-macrodynamics-in-algorithmic-recourse/](https://www.paltmeyer.com/endogenous-macrodynamics-in-algorithmic-recourse/). 
- Many other related posts on my [blog](https://www.paltmeyer.com/blog).

## Image Sources

- Copyright for stock images belongs to TU Delft.
- All other images, graphics or animations were created by us.

## References 